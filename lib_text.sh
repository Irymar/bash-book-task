#!/usr/bin/env bash

# Бібліотека для обробки тексту.
# Функція extract_word_stats:
#  - приймає шлях до файлу з книжкою
#  - виводить таблицю: слово кількість
#    (слова довші за 15 символів і НЕ починаються на в/В/т/Т)

extract_word_stats() {
  local input_file="$1"

  # 1. Беремо текст з файлу і розбиваємо на слова (по одному в рядок)
  # 2. Фільтруємо:
  #    - довжина > 15
  #    - перша літера НЕ в/В/т/Т
  # 3. Рахуємо, скільки разів кожне слово зустрічається
  # 4. Сортуємо за кількістю (від більшого до меншого)
  # 5. Форматуємо як "слово кількість"

  tr -cs '[:alpha:]' '\n' < "$input_file" \
    | awk '
        {
          w = $0
          # Пропускаємо порожні рядки
          if (w == "") next

          # Фільтр за довжиною: беремо тільки слова довші за 15 символів
          if (length(w) <= 15) next

          # Перша літера слова
          first = substr(w, 1, 1)

          # Відкидаємо слова на в/В/т/Т
          if (first == "в" || first == "В" || first == "т" || first == "Т")
            next

          # Якщо слово пройшло всі фільтри — друкуємо
          print w
        }
      ' \
    | sort \
    | uniq -c \
    | sort -nr \
    | awk '
        {
          count = $1   # перший стовпець — кількість
          word  = $2   # другий стовпець — слово
          # Форматований вивід: "слово кількість"
          printf "%s %d\n", word, count
        }
      '
}
